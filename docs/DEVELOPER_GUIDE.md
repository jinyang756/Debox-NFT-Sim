# 开发者指南

## 项目架构

### 技术栈
- **后端**: Node.js + Express
- **前端**: HTML + CSS + JavaScript + EJS模板引擎
- **数据存储**: JSON文件（生产环境建议使用数据库）
- **测试框架**: Jest
- **部署工具**: PM2（可选）

### 目录结构说明
```
src/
├── app.js              # Express应用配置
├── routes/             # API路由定义
├── controllers/        # 业务逻辑处理
├── models/             # 数据模型
├── engine/             # 交易引擎核心
├── utils/              # 工具函数
└── middleware/         # 中间件
```

## 核心模块

### 交易引擎 (src/engine/)
交易引擎是平台的核心，包含以下组件：

1. **VirtualTradingEngine.js**: 交易引擎主类，协调各个组件
2. **MarketSimulator.js**: 市场模拟器，生成和更新市场价格
3. **OrderManager.js**: 订单管理器，处理订单执行和持仓管理
4. **RiskManager.js**: 风险管理器，检查交易风险

### 数据模型 (src/models/)
数据模型负责数据的持久化存储：

1. **User.js**: 用户模型
2. **Config.js**: 配置模型
3. **Transaction.js**: 交易记录模型
4. **Position.js**: 持仓模型
5. **MarketData.js**: 市场数据模型

### 控制器 (src/controllers/)
控制器处理HTTP请求并调用相应的业务逻辑：

1. **userController.js**: 用户相关操作
2. **configController.js**: 配置管理
3. **tradeController.js**: 交易操作
4. **marketController.js**: 市场数据查询

## API设计

### RESTful原则
- 使用HTTP动词表示操作类型（GET, POST, PUT, DELETE）
- URL表示资源
- 状态码表示操作结果

### 错误处理
- 统一的错误响应格式
- 详细的错误信息
- 适当的HTTP状态码

## 开发流程

### 1. 添加新功能
1. 在`routes/`中定义API路由
2. 在`controllers/`中实现业务逻辑
3. 在`models/`中添加数据模型（如需要）
4. 在`engine/`中扩展交易引擎（如需要）
5. 添加相应的测试用例

### 2. 数据验证
1. 在`middleware/validation.js`中添加验证规则
2. 在路由中使用验证中间件
3. 在控制器中处理验证错误

### 3. 测试
1. 单元测试：测试独立的函数和类
2. 集成测试：测试API接口
3. 端到端测试：测试完整业务流程

## 代码规范

### 命名规范
- 文件名：小驼峰命名法（camelCase）
- 类名：大驼峰命名法（PascalCase）
- 函数名：小驼峰命名法（camelCase）
- 变量名：小驼峰命名法（camelCase）

### 代码风格
- 使用2个空格缩进
- 每行代码不超过80个字符
- 函数长度不超过50行
- 文件长度不超过300行

### 注释规范
- 函数注释：说明函数功能、参数和返回值
- 复杂逻辑注释：解释实现原理
- TODO注释：标记待完成的功能

## 扩展建议

### 数据库集成
当前版本使用JSON文件存储数据，生产环境建议集成数据库：
1. 安装数据库驱动（如MongoDB, PostgreSQL等）
2. 修改models中的数据访问逻辑
3. 添加数据库连接配置
4. 更新数据备份和恢复脚本

### 实时通信
添加WebSocket支持以实现实时数据推送：
1. 集成Socket.IO或原生WebSocket
2. 在MarketSimulator中添加实时数据推送
3. 在前端添加实时数据接收和显示

### 缓存优化
添加Redis缓存以提高性能：
1. 集成Redis客户端
2. 缓存频繁访问的数据（如市场数据）
3. 添加缓存更新机制

### 安全增强
1. 使用JWT替代简单的Bearer Token
2. 添加输入验证和过滤
3. 实施速率限制
4. 添加CSRF保护
5. 使用HTTPS

## 部署优化

### 性能优化
1. 启用Gzip压缩
2. 静态资源缓存
3. 数据库查询优化
4. 使用CDN加速静态资源

### 监控告警
1. 集成应用性能监控（APM）
2. 设置系统资源监控
3. 添加日志分析和告警
4. 实施健康检查接口

## 贡献指南

### 提交代码
1. Fork项目仓库
2. 创建功能分支
3. 提交代码并编写清晰的提交信息
4. 发起Pull Request

### 代码审查
1. 确保代码符合规范
2. 添加必要的测试用例
3. 更新相关文档
4. 通过所有自动化测试

### 报告问题
1. 使用搜索功能查看是否已有相同问题
2. 提供详细的环境信息
3. 提供复现步骤
4. 提供错误日志和截图